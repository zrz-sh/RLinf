# OpenVLA Supervised Fine-Tuning Configuration
# Simplified config that follows existing RLinf patterns

defaults:
  - _self_
  - override hydra/job_logging: stdout

hydra:
  run:
    dir: ./outputs/${now:%Y-%m-%d}/${now:%H-%M-%S}
  job:
    chdir: true

# Cluster Configuration  
cluster:
  num_nodes: 1
  num_gpus_per_node: 1
  component_placement:
    actor: "0"  # Use GPU 0 for SFT actor

# Runner Configuration
runner:
  task_type: embodied
  max_epochs: 10
  max_steps: -1
  save_interval: 2
  val_check_interval: -1
  seq_length: 4096
  max_prompt_length: 256
  
  logger:
    log_path: ./logs/sft_training
    project_name: openvla_sft
    experiment_name: lerobot_aloha
    logger_backends: ["tensorboard"]

# Actor (SFT Model) Configuration
actor:
  group_name: sft_actor
  training_backend: fsdp
  checkpoint_load_path: /mnt/public/xusi/models/openvla-7b
  checkpoint_save_path: ./logs/sft_training
  micro_batch_size: 4
  global_batch_size: 4
  seed: 1234
  enable_offload: false
  
  # Dataset Configuration
  dataset:
    repo_id: lerobot/aloha_sim_insertion_human_v0
    action_horizon: 10
    action_dim: 7
    max_token_len: 256
    batch_size: 4
    num_workers: 4
  
  # Model Configuration
  model:
    model_name: openvla
    action_dim: 7
    num_action_chunks: 10
    hidden_size: 4096
    unnorm_key: null
    vh_mode: false
    precision: bf16
    vocab_size: 32000
    image_size: [224, 224]
    attn_implementation: flash_attention_2
    low_cpu_mem_usage: true
    trust_remote_code: true
  
  # Optimizer Configuration
  optim:
    lr: 1.0e-5
    adam_beta1: 0.9
    adam_beta2: 0.999
    adam_eps: 1.0e-05
    clip_grad: 1.0
  
  # Tokenizer Configuration
  tokenizer:
    tokenizer_type: HuggingFaceTokenizer
    tokenizer_model: ${actor.checkpoint_load_path}
    use_fast: false
    trust_remote_code: true
    padding_side: left
  
  # Channel Configuration
  channel:
    name: sft_actor_channel
    queue_name: sft_actor_queue
    queue_size: 10

# Algorithm section (minimal for SFT)
algorithm:
  # SFT doesn't need most algorithm parameters, but some might be expected
  pass